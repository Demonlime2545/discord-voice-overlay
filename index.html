<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MINT#3021 - MINT Library</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #1e1e1e;
    color: #fff;
    margin: 0;
    padding: 0;
}
.header {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #222;
    padding: 10px 20px;
    position: relative;
}
.user-info {
    position: absolute;
    left: 20px;
    display: flex;
    align-items: center;
}
.user-info img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
}
.user-info span {
    font-weight: bold;
    font-size: 16px;
}
.navbar {
    display: flex;
    justify-content: center;
}
.navbar a {
    color: #fff;
    text-decoration: none;
    padding: 10px 20px;
    margin: 0 10px;
    border-radius: 5px;
    transition: background-color 0.3s;
}
.navbar a:hover,
.navbar a.active {
    background-color: #00ffff;
    color: #000;
}
.content {
    padding: 20px;
}
h1 {
    color: #00ffff;
    margin-bottom: 20px;
}

/* Members & avatars */
.members-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
}
.member-card {
    background-color: #2a2a2a;
    border-radius: 10px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.member-card h3 {
    margin: 5px 0;
    font-size: 16px;
    text-align: center;
}
.avatar-grid {
    display: flex;
    justify-content: space-around;
    width: 100%;
    margin-top: 10px;
}
.avatar-grid img {
    width: 40px;
    height: 40px;
    border-radius: 5px;
    border: 2px solid #444;
    object-fit: cover;
}
.status-label {
    font-size: 10px;
    text-align: center;
    margin-top: 2px;
}
</style>
</head>
<body>

<div class="header">
    <div class="user-info">
        <img src="https://i.pinimg.com/736x/f8/f0/0f/f8f00f81397dfdd4c0b2cadbd4172166.jpg" alt="Avatar">
        <span>MINT#3021</span>
    </div>
    <div class="navbar">
        <a href="index.html" class="active">Library</a>
        <a href="overlay.html">Overlays</a>
        <a href="setting.html">Setting</a>
    </div>
</div>

<div class="content">
    <h1>MINT Library</h1>
    <div class="members-container" id="members-container"></div>
</div>

<script>
const statuses = ['speaking','not-speaking','mic-off','headphones'];
const membersContainer = document.getElementById('members-container');

// โหลดสมาชิกทั้งหมด
async function loadMembers() {
    try {
        const res = await fetch('/members'); // เรียก API /members
        const data = await res.json();
        const members = data.members;

        // render member cards
        members.forEach(async member => {
            const card = document.createElement('div');
            card.className = 'member-card';
            card.innerHTML = `<h3>${member.username}</h3>
                <div class="avatar-grid" id="avatars-${member.id}"></div>`;

            membersContainer.appendChild(card);

            const avatarGrid = document.getElementById(`avatars-${member.id}`);

            // โหลด avatars ของแต่ละ user
            try {
                const res2 = await fetch(`/avatars/${member.id}`);
                const avatars = await res2.json();

                statuses.forEach(status=>{
                    const wrapper = document.createElement('div');
                    wrapper.style.display='flex';
                    wrapper.style.flexDirection='column';
                    wrapper.style.alignItems='center';

                    const img = document.createElement('img');
                    img.src = avatars[status] || `icons/${status}.png`;
                    img.alt = status;

                    const label = document.createElement('span');
                    label.className = 'status-label';
                    label.textContent = status;

                    wrapper.appendChild(img);
                    wrapper.appendChild(label);
                    avatarGrid.appendChild(wrapper);
                });
            } catch(e){
                console.error(`Cannot load avatars for ${member.username}`, e);
            }
        });
    } catch(err){
        console.error('Cannot load members', err);
    }
}

loadMembers();
</script>

</body>
</html>
